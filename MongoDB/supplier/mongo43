#!/bin/bash
mongo localhost:27017/supplier --eval 'db.supplier.aggregate([{$match:{$and:[{s_nation: "UNITED STATES"},{"lineorder.customer.c_region":"AMERICA"},{$or:[{"lineorder.orderdate.d_year":1997},{"lineorder.orderdate.d_year":1998}]},{"lineorder.part.p_category":"MFGR#14"}]}},{$unwind:"$lineorder"},{$match:{$and:[{s_nation: "UNITED STATES"},{"lineorder.customer.c_region":"AMERICA"},{$or:[{"lineorder.orderdate.d_year":1997},{"lineorder.orderdate.d_year":1998}]},{"lineorder.part.p_category":"MFGR#14"}]}},{$project:{"lineorder.orderdate.d_year":1,s_city:1,"lineorder.part.p_brand1":1,dim:{$subtract:["$lineorder.lo_revenue","$lineorder.lo_supplycost"]}}},{$group:{_id:{d_year:"$lineorder.orderdate.d_year",s_city:"$s_city",p_brand1:"$lineorder.part.p_brand1"}, profit:{$sum: "$dim"}}}]).toArray()' >>~/Documentos/benchmark/mongoDB/suppliermo/query/shell/resultados/query43.txt

