#!/bin/bash
mongo localhost:27017/supplier --eval 'db.supplier.aggregate([{$match:{$and:[{s_region: "AMERICA"},{"lineorder.customer.c_region":"AMERICA"},{$or:[{"lineorder.orderdate.d_year":1997},{"lineorder.orderdate.d_year":1998}]},{$or:[{"lineorder.part.p_mfgr":"MFGR#1"},{"lineorder.part.p_mfgr":"MFGR#2"}]}]}},{$unwind:"$lineorder"},{$match:{$and:[{s_region: "AMERICA"},{"lineorder.customer.c_region":"AMERICA"},{$or:[{"lineorder.orderdate.d_year":1997},{"lineorder.orderdate.d_year":1998}]},{$or:[{"lineorder.part.p_mfgr":"MFGR#1"},{"lineorder.part.p_mfgr":"MFGR#2"}]}]}},{$project:{"lineorder.orderdate.d_year":1, s_nation:1,"lineorder.part.p_category":1,dim:{$subtract:["$lineorder.lo_revenue","$lineorder.lo_supplycost"]}}},{$group:{_id:{d_year:"$lineorder.orderdate.d_year",s_nation:"$s_nation",p_category:"$lineorder.part.p_category"}, profit:{$sum: "$dim"}}}]).toArray()' >>~/Documentos/benchmark/mongoDB/suppliermo/query/shell/resultados/query42.txt

