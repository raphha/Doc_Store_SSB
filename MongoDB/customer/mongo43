#!/bin/bash
mongo localhost:27017/customer_ssb --eval 'db.customer.aggregate([{"$match":{"$and":[{"c_region":"AMERICA"},{"lineorder.supplier.s_nation": "UNITED STATES"},{"$or":[{"lineorder.orderdate.d_year":1997},{"lineorder.orderdate.d_year":1998}]},{"lineorder.part.p_category":"MFGR#14"}]}},{"$unwind":"$lineorder"},{"$match":{"$and":[{"c_region":"AMERICA"},{"lineorder.supplier.s_nation": "UNITED STATES"},{"$or":[{"lineorder.orderdate.d_year":1997},{"lineorder.orderdate.d_year":1998}]},{"lineorder.part.p_category":"MFGR#14"}]}},{"$project":{"lineorder.orderdate.d_year":1,"lineorder.supplier.s_city":1,"lineorder.part.p_brand1":1,"dim":{"$subtract":["$lineorder.lo_revenue","$lineorder.lo_supplycost"]}}},{"$group":{"_id":{"d_year":"$lineorder.orderdate.d_year","s_city":"$lineorder.supplier.s_city","p_brand1":"$lineorder.part.p_brand1"}, "profit":{"$sum": "$dim"}}}]).toArray()' >>~/Documentos/benchmark/mongoDB/customermo/query/shell/resultados/query43.txt

