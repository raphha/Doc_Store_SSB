from pymongo import MongoClient
import time

def Inicio():

	client = MongoClient()

	db = client['teste']

	start = time.time()

	cursor = db.testando.aggregate([{"$match":{"$and":[{"c_region":"AMERICA"},{'lineorders.supplier.s_region': "AMERICA"},{"$or":[{'lineorders.orderdate.d_year':1997},{'lineorders.orderdate.d_year':1998}]},{"$or":[{'lineorders.part.p_mfgr':"MFGR#1"},{'lineorders.part.p_mfgr':"MFGR#2"}]}]}},{"$unwind":'$lineorders'},{"$match":{"$and":[{"c_region":"AMERICA"},{'lineorders.supplier.s_region':"AMERICA"},{"$or":[{'lineorders.part.p_mfgr':"MFGR#1"},{'lineorders.part.p_mfgr':"MFGR#2"}]}]}},{"$project":{'lineorders.orderdate.d_year':1,'lineorders.supplier.s_nation':1,'lineorders.part.p_category':1,"dim":{"$subtract":["$lineorders.lo_revenue","$lineorders.lo_supplycost"]}}},{"$group":{"_id":{"d_year":'$lineorders.orderdate.d_year',"s_nation":'$lineorders.supplier.s_nation',"3p_category":'$lineorders.part.p_category'}, "profit":{"$sum": "$dim"}}},{"$sort":{'_id':1,'_id.d_year':1,'_id.s_nation':1}}])


	for document in cursor:
		print(document)

	end = time.time()

	print('tempo:'+ str(end - start))

Inicio()

#para funcionar no pymongo todos os campos tem que estar em string
