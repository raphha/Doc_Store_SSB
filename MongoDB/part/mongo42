#!/bin/bash
mongo localhost:27017/part --eval 'db.part.aggregate([{"$match":{"$and":[{"lineorder.customer.c_region":"AMERICA"},{"lineorder.supplier.s_region":"AMERICA"},{"$or":[{"lineorder.orderdate.d_year":1997},{"lineorder.orderdate.d_year":1998}]},{"$or":[{"p_mfgr":"MFGR#1"},{"p_mfgr":"MFGR#2"}]}]}},{"$unwind":"$lineorder"},{"$match":{"$and":[{"lineorder.customer.c_region":"AMERICA"},{"lineorder.supplier.s_region":"AMERICA"},{"$or":[{"lineorder.orderdate.d_year":1997},{"lineorder.orderdate.d_year":1998}]},{"$or":[{"p_mfgr":"MFGR#1"},{"p_mfgr":"MFGR#2"}]}]}},{"$project":{"lineorder.orderdate.d_year":1,"lineorder.supplier.s_nation":1,"p_category":1,"dim":{"$subtract":["$lineorder.lo_revenue","$lineorder.lo_supplycost"]}}},{"$group":{"_id":{"d_year":"$lineorder.orderdate.d_year","s_nation":"$lineorder.supplier.s_nation","p_category":"$p_category"}, "profit":{"$sum": "$dim"}}}]).toArray()' >>~/Documentos/benchmark/mongoDB/partmo/query/shell/resultados/query42.txt

